<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./index.css">
  </head>
  <body>
  </br>
  <div class="Controls">
    <label>Link</label>
    <input type="text" id="Link" />
    <label>Name</label>
    <input type="text" id="Name" />
    <input type="button" id="SaveButton" class="controlbutton" value="Hinzufügen"/>
  </br>
    <label id="ErrorTxt" style="color:red;"></label>
  </div>
    <div class="Content">
      <input type="button" onclick="ipcRenderer.send('compare')" class="controlbutton" value="Vergleichen"/>
    </br>
    </br>
      <table class="MainTable" id="MainTable">
        <tr>
          <th>Name</th>
          <th>Website</th>
          <th>Änderung?</th>
          <th>Suchtreffer</th>
          <th>Datum</th>
          <th>Löschen</th>
        </tr>
      </table>
      </div>
      <div class="SearchArea">
      <label style="font-size:18px">Wörter mit komma trennen</label>
    </br>
      <textarea id="SearchStringTextBox" rows="6" cols="30">
      </textarea>
    </br>
      <input type="button" class="controlbutton" id="SearchButton" value="Suchen" />
      <input type="button" class="controlbutton" id="SearchSaveButton" value="Speichern" />
  </div>
  </body>
  <script>
  var $ = require('jquery');
  const {ipcRenderer} = require('electron')
  $('#DataPathInput').click(function(){
    ipcRenderer.send('update-config');
    $('#Controls').attr("display", "block");
  })
  ipcRenderer.send('init');
  ipcRenderer.on('error-msg', (event, message) => {
  $('#ErrorTxt').text(message);
  })
  ipcRenderer.on('searchobject', (event, message) => {
    console.log(message);
  $('#SearchStringTextBox').text(message);
  })
  ipcRenderer.on('hit', (event, doc) => {
    console.log(doc);
    var cellname = "#" + doc.Name + "-hitcell";
    if(doc.hits === true){
      $(cellname).text("Treffer!");
      $(cellname).attr("style", "background-color: green;")
    }
    if(doc.hits === 0){
      $(cellname).text("Kein Treffer.");
      $(cellname).attr("style", "background-color: yellow;")
    }
  })
  ipcRenderer.on('removed-doc', (event, name) =>{
    name = '#' + name + '-row';
    $(name).remove();
  })
  ipcRenderer.on('update-false', (event, cell) =>{
    console.log(cell);
    var selectedcell = document.getElementById(cell);
    selectedcell.innerHTML = "Keine Änderungen";
    selectedcell.class = "negativ-cell";
  })
  ipcRenderer.on('update-true', (event, cell) =>{
    var selectedcell = document.getElementById(cell);
    selectedcell.innerHTML = "Änderung!";
    selectedcell.class = "positiv-cell";
  })
  ipcRenderer.on('page', (event, page) => { //Hell
    console.log(page);
    var table = document.getElementById('MainTable')
    var newrow = table.insertRow(table.rows.length)
    newrow.id = page.Name + "-row";
    var NameCell = newrow.insertCell(0)
    var LinkCell = newrow.insertCell(1)
    var ChangesCell = newrow.insertCell(2)
    var HitCell = newrow.insertCell(3)
    var DateCell = newrow.insertCell(4)
    var DeleteCell = newrow.insertCell(5)
    NameCell.innerHTML = page.Name;
    LinkCell.innerHTML = "<a href='" + page.URL + "'>" + page.URL + "</a>";
    HitCell.id = page.Name + "-hitcell";
    HitCell.innerHTML = 0;
    d = new Date(page.Date);
    DateCell.innerHTML = d.getDay() + "/" + d.getMonth() + "/" + d.getFullYear();
    DateCell.id = page.Name + "-datecell";
    var DeleteButton = document.createElement('button');
    DeleteButton.setAttribute('onclick', "remove('" + page.Name + "')")
    DeleteButton.innerHTML = "Löschen";
    DeleteCell.appendChild(DeleteButton);
    if(page.Changes == true){
      ChangesCell.innerHTML = "Änderung"
      ChangesCell.id = page.Name + "-changescell";
    } else {
      ChangesCell.innerHTML = "Keine Änderung";
      ChangesCell.id = page.Name + "-changescell";
    }
  })
  $("#SaveButton").click(function(){
    var info = {};
    info.URL = $('#Link').val();
    info.Name = $('#Name').val();
    if(info.URL == "" || info.Name == ""){
      $('#ErrorTxt').text('Kein Link oder Name')
    } else {
      if(info.URL.startsWith("http://" || "https://")){
              ipcRenderer.send('save', info);
      } else {
        info.URL = "http://" + info.URL;
        ipcRenderer.send('save', info);
      }
    }
  })
  $("#SearchButton").click(function(){
    ipcRenderer.send('search')
  })
  $("#SearchSaveButton").click(function(){
    var SearchString = $("#SearchStringTextBox").val();
    ipcRenderer.send('save-search', SearchString)
  })
  function remove(Name){
    ipcRenderer.send('remove', Name);
  }
  </script>
</html>
